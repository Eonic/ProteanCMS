/**
 * Minified by jsDelivr using Terser v5.17.1.
 * Original file: /npm/leaflet@1.9.4/src/layer/tile/GridLayer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Layer}from"../Layer";import Browser from"../../core/Browser";import*as Util from"../../core/Util";import*as DomUtil from"../../dom/DomUtil";import{Point}from"../../geometry/Point";import{Bounds}from"../../geometry/Bounds";import{LatLngBounds,toLatLngBounds as latLngBounds}from"../../geo/LatLngBounds";export var GridLayer=Layer.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Browser.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){Util.setOptions(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),DomUtil.remove(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(DomUtil.toFront(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(DomUtil.toBack(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof Point?t:new Point(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var i,e=this.getPane().children,o=-t(-1/0,1/0),s=0,n=e.length;s<n;s++)i=e[s].style.zIndex,e[s]!==this._container&&i&&(o=t(o,+i));isFinite(o)&&(this.options.zIndex=o+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Browser.ielt9){DomUtil.setOpacity(this._container,this.options.opacity);var t=+new Date,i=!1,e=!1;for(var o in this._tiles){var s=this._tiles[o];if(s.current&&s.loaded){var n=Math.min(1,(t-s.loaded)/200);DomUtil.setOpacity(s.el,n),n<1?i=!0:(s.active?e=!0:this._onOpaqueTile(s),s.active=!0)}}e&&!this._noPrune&&this._pruneTiles(),i&&(Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=Util.requestAnimFrame(this._updateOpacity,this))}},_onOpaqueTile:Util.falseFn,_initContainer:function(){this._container||(this._container=DomUtil.create("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,i=this.options.maxZoom;if(void 0!==t){for(var e in this._levels)e=Number(e),this._levels[e].el.children.length||e===t?(this._levels[e].el.style.zIndex=i-Math.abs(t-e),this._onUpdateLevel(e)):(DomUtil.remove(this._levels[e].el),this._removeTilesAtZoom(e),this._onRemoveLevel(e),delete this._levels[e]);var o=this._levels[t],s=this._map;return o||((o=this._levels[t]={}).el=DomUtil.create("div","leaflet-tile-container leaflet-zoom-animated",this._container),o.el.style.zIndex=i,o.origin=s.project(s.unproject(s.getPixelOrigin()),t).round(),o.zoom=t,this._setZoomTransform(o,s.getCenter(),s.getZoom()),Util.falseFn(o.el.offsetWidth),this._onCreateLevel(o)),this._level=o,o}},_onUpdateLevel:Util.falseFn,_onRemoveLevel:Util.falseFn,_onCreateLevel:Util.falseFn,_pruneTiles:function(){if(this._map){var t,i,e=this._map.getZoom();if(e>this.options.maxZoom||e<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(i=this._tiles[t]).retain=i.current;for(t in this._tiles)if((i=this._tiles[t]).current&&!i.active){var o=i.coords;this._retainParent(o.x,o.y,o.z,o.z-5)||this._retainChildren(o.x,o.y,o.z,o.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var i in this._tiles)this._tiles[i].coords.z===t&&this._removeTile(i)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)DomUtil.remove(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,i,e,o){var s=Math.floor(t/2),n=Math.floor(i/2),r=e-1,a=new Point(+s,+n);a.z=+r;var l=this._tileCoordsToKey(a),h=this._tiles[l];return h&&h.active?(h.retain=!0,!0):(h&&h.loaded&&(h.retain=!0),r>o&&this._retainParent(s,n,r,o))},_retainChildren:function(t,i,e,o){for(var s=2*t;s<2*t+2;s++)for(var n=2*i;n<2*i+2;n++){var r=new Point(s,n);r.z=e+1;var a=this._tileCoordsToKey(r),l=this._tiles[a];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),e+1<o&&this._retainChildren(s,n,e+1,o))}},_resetView:function(t){var i=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),i,i)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var i=this.options;return void 0!==i.minNativeZoom&&t<i.minNativeZoom?i.minNativeZoom:void 0!==i.maxNativeZoom&&i.maxNativeZoom<t?i.maxNativeZoom:t},_setView:function(t,i,e,o){var s=Math.round(i);s=void 0!==this.options.maxZoom&&s>this.options.maxZoom||void 0!==this.options.minZoom&&s<this.options.minZoom?void 0:this._clampZoom(s);var n=this.options.updateWhenZooming&&s!==this._tileZoom;o&&!n||(this._tileZoom=s,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==s&&this._update(t),e||this._pruneTiles(),this._noPrune=!!e),this._setZoomTransforms(t,i)},_setZoomTransforms:function(t,i){for(var e in this._levels)this._setZoomTransform(this._levels[e],t,i)},_setZoomTransform:function(t,i,e){var o=this._map.getZoomScale(e,t.zoom),s=t.origin.multiplyBy(o).subtract(this._map._getNewPixelOrigin(i,e)).round();Browser.any3d?DomUtil.setTransform(t.el,s,o):DomUtil.setPosition(t.el,s)},_resetGrid:function(){var t=this._map,i=t.options.crs,e=this._tileSize=this.getTileSize(),o=this._tileZoom,s=this._map.getPixelWorldBounds(this._tileZoom);s&&(this._globalTileRange=this._pxBoundsToTileRange(s)),this._wrapX=i.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,i.wrapLng[0]],o).x/e.x),Math.ceil(t.project([0,i.wrapLng[1]],o).x/e.y)],this._wrapY=i.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([i.wrapLat[0],0],o).y/e.x),Math.ceil(t.project([i.wrapLat[1],0],o).y/e.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var i=this._map,e=i._animatingZoom?Math.max(i._animateToZoom,i.getZoom()):i.getZoom(),o=i.getZoomScale(e,this._tileZoom),s=i.project(t,this._tileZoom).floor(),n=i.getSize().divideBy(2*o);return new Bounds(s.subtract(n),s.add(n))},_update:function(t){var i=this._map;if(i){var e=this._clampZoom(i.getZoom());if(void 0===t&&(t=i.getCenter()),void 0!==this._tileZoom){var o=this._getTiledPixelBounds(t),s=this._pxBoundsToTileRange(o),n=s.getCenter(),r=[],a=this.options.keepBuffer,l=new Bounds(s.getBottomLeft().subtract([a,-a]),s.getTopRight().add([a,-a]));if(!(isFinite(s.min.x)&&isFinite(s.min.y)&&isFinite(s.max.x)&&isFinite(s.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var h in this._tiles){var m=this._tiles[h].coords;m.z===this._tileZoom&&l.contains(new Point(m.x,m.y))||(this._tiles[h].current=!1)}if(Math.abs(e-this._tileZoom)>1)this._setView(t,e);else{for(var _=s.min.y;_<=s.max.y;_++)for(var d=s.min.x;d<=s.max.x;d++){var u=new Point(d,_);if(u.z=this._tileZoom,this._isValidTile(u)){var p=this._tiles[this._tileCoordsToKey(u)];p?p.current=!0:r.push(u)}}if(r.sort((function(t,i){return t.distanceTo(n)-i.distanceTo(n)})),0!==r.length){this._loading||(this._loading=!0,this.fire("loading"));var c=document.createDocumentFragment();for(d=0;d<r.length;d++)this._addTile(r[d],c);this._level.el.appendChild(c)}}}}},_isValidTile:function(t){var i=this._map.options.crs;if(!i.infinite){var e=this._globalTileRange;if(!i.wrapLng&&(t.x<e.min.x||t.x>e.max.x)||!i.wrapLat&&(t.y<e.min.y||t.y>e.max.y))return!1}if(!this.options.bounds)return!0;var o=this._tileCoordsToBounds(t);return latLngBounds(this.options.bounds).overlaps(o)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var i=this._map,e=this.getTileSize(),o=t.scaleBy(e),s=o.add(e);return[i.unproject(o,t.z),i.unproject(s,t.z)]},_tileCoordsToBounds:function(t){var i=this._tileCoordsToNwSe(t),e=new LatLngBounds(i[0],i[1]);return this.options.noWrap||(e=this._map.wrapLatLngBounds(e)),e},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var i=t.split(":"),e=new Point(+i[0],+i[1]);return e.z=+i[2],e},_removeTile:function(t){var i=this._tiles[t];i&&(DomUtil.remove(i.el),delete this._tiles[t],this.fire("tileunload",{tile:i.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){DomUtil.addClass(t,"leaflet-tile");var i=this.getTileSize();t.style.width=i.x+"px",t.style.height=i.y+"px",t.onselectstart=Util.falseFn,t.onmousemove=Util.falseFn,Browser.ielt9&&this.options.opacity<1&&DomUtil.setOpacity(t,this.options.opacity)},_addTile:function(t,i){var e=this._getTilePos(t),o=this._tileCoordsToKey(t),s=this.createTile(this._wrapCoords(t),Util.bind(this._tileReady,this,t));this._initTile(s),this.createTile.length<2&&Util.requestAnimFrame(Util.bind(this._tileReady,this,t,null,s)),DomUtil.setPosition(s,e),this._tiles[o]={el:s,coords:t,current:!0},i.appendChild(s),this.fire("tileloadstart",{tile:s,coords:t})},_tileReady:function(t,i,e){i&&this.fire("tileerror",{error:i,tile:e,coords:t});var o=this._tileCoordsToKey(t);(e=this._tiles[o])&&(e.loaded=+new Date,this._map._fadeAnimated?(DomUtil.setOpacity(e.el,0),Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=Util.requestAnimFrame(this._updateOpacity,this)):(e.active=!0,this._pruneTiles()),i||(DomUtil.addClass(e.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:e.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Browser.ielt9||!this._map._fadeAnimated?Util.requestAnimFrame(this._pruneTiles,this):setTimeout(Util.bind(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var i=new Point(this._wrapX?Util.wrapNum(t.x,this._wrapX):t.x,this._wrapY?Util.wrapNum(t.y,this._wrapY):t.y);return i.z=t.z,i},_pxBoundsToTileRange:function(t){var i=this.getTileSize();return new Bounds(t.min.unscaleBy(i).floor(),t.max.unscaleBy(i).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});export function gridLayer(t){return new GridLayer(t)}
//# sourceMappingURL=/sm/8de5856b3b37ac9980a88b49466061f4ab33fc34ed232a17812a988b28e6556f.map
/**
 * Minified by jsDelivr using Terser v5.13.1.
 * Original file: /npm/@fancyapps/ui@4.0.27/src/Panzoom/Panzoom.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{extend}from"../shared/utils/extend.js";import{round}from"../shared/utils/round.js";import{isScrollable}from"../shared/utils/isScrollable.js";import{ResizeObserver}from"../shared/utils/ResizeObserver.js";import{PointerTracker,getMidpoint,getDistance}from"../shared/utils/PointerTracker.js";import{getTextNodeFromPoint}from"../shared/utils/getTextNodeFromPoint.js";import{getFullWidth,getFullHeight,calculateAspectRatioFit}from"../shared/utils/getDimensions.js";import{Base}from"../shared/Base/Base.js";import{Plugins}from"./plugins/index.js";const defaults={touch:!0,zoom:!0,pinchToZoom:!0,panOnlyZoomed:!1,lockAxis:!1,friction:.64,decelFriction:.88,zoomFriction:.74,bounceForce:.2,baseScale:1,minScale:1,maxScale:2,step:.5,textSelection:!1,click:"toggleZoom",wheel:"zoom",wheelFactor:42,wheelLimit:5,draggableClass:"is-draggable",draggingClass:"is-dragging",ratio:1};export class Panzoom extends Base{constructor(t,i={}){super(extend(!0,{},defaults,i)),this.state="init",this.$container=t;for(const t of["onLoad","onWheel","onClick"])this[t]=this[t].bind(this);this.initLayout(),this.resetValues(),this.attachPlugins(Panzoom.Plugins),this.trigger("init"),this.updateMetrics(),this.attachEvents(),this.trigger("ready"),!1===this.option("centerOnStart")?this.state="ready":this.panTo({friction:0}),t.__Panzoom=this}initLayout(){const t=this.$container;if(!(t instanceof HTMLElement))throw new Error("Panzoom: Container not found");const i=this.option("content")||t.querySelector(".panzoom__content");if(!i)throw new Error("Panzoom: Content not found");this.$content=i;let e=this.option("viewport")||t.querySelector(".panzoom__viewport");e||!1===this.option("wrapInner")||(e=document.createElement("div"),e.classList.add("panzoom__viewport"),e.append(...t.childNodes),t.appendChild(e)),this.$viewport=e||i.parentNode}resetValues(){this.updateRate=this.option("updateRate",/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?250:24),this.container={width:0,height:0},this.viewport={width:0,height:0},this.content={origWidth:0,origHeight:0,width:0,height:0,x:this.option("x",0),y:this.option("y",0),scale:this.option("baseScale")},this.transform={x:0,y:0,scale:1},this.resetDragPosition()}onLoad(t){this.updateMetrics(),this.panTo({scale:this.option("baseScale"),friction:0}),this.trigger("load",t)}onClick(t){if(t.defaultPrevented)return;if(this.option("textSelection")&&window.getSelection().toString().length)return void t.stopPropagation();const i=this.$content.getClientRects()[0];if("ready"!==this.state&&(this.dragPosition.midPoint||Math.abs(i.top-this.dragStart.rect.top)>1||Math.abs(i.left-this.dragStart.rect.left)>1))return t.preventDefault(),void t.stopPropagation();!1!==this.trigger("click",t)&&this.option("zoom")&&"toggleZoom"===this.option("click")&&(t.preventDefault(),t.stopPropagation(),this.zoomWithClick(t))}onWheel(t){!1!==this.trigger("wheel",t)&&this.option("zoom")&&this.option("wheel")&&this.zoomWithWheel(t)}zoomWithWheel(t){void 0===this.changedDelta&&(this.changedDelta=0);const i=Math.max(-1,Math.min(1,-t.deltaY||-t.deltaX||t.wheelDelta||-t.detail)),e=this.content.scale;let s=e*(100+i*this.option("wheelFactor"))/100;if(i<0&&Math.abs(e-this.option("minScale"))<.01||i>0&&Math.abs(e-this.option("maxScale"))<.01?(this.changedDelta+=Math.abs(i),s=e):(this.changedDelta=0,s=Math.max(Math.min(s,this.option("maxScale")),this.option("minScale"))),this.changedDelta>this.option("wheelLimit"))return;if(t.preventDefault(),s===e)return;const o=this.$content.getBoundingClientRect(),n=t.clientX-o.left,h=t.clientY-o.top;this.zoomTo(s,{x:n,y:h})}zoomWithClick(t){const i=this.$content.getClientRects()[0],e=t.clientX-i.left,s=t.clientY-i.top;this.toggleZoom({x:e,y:s})}attachEvents(){this.$content.addEventListener("load",this.onLoad),this.$container.addEventListener("wheel",this.onWheel,{passive:!1}),this.$container.addEventListener("click",this.onClick,{passive:!1}),this.initObserver();const t=new PointerTracker(this.$container,{start:(i,e)=>{if(!this.option("touch"))return!1;if(this.velocity.scale<0)return!1;const s=e.composedPath()[0];if(!t.currentPointers.length){if(-1!==["BUTTON","TEXTAREA","OPTION","INPUT","SELECT","VIDEO"].indexOf(s.nodeName))return!1;if(this.option("textSelection")&&getTextNodeFromPoint(s,i.clientX,i.clientY))return!1}return!isScrollable(s)&&(!1!==this.trigger("touchStart",e)&&("mousedown"===e.type&&e.preventDefault(),this.state="pointerdown",this.resetDragPosition(),this.dragPosition.midPoint=null,this.dragPosition.time=Date.now(),!0))},move:(i,e,s)=>{if("pointerdown"!==this.state)return;if(!1===this.trigger("touchMove",s))return void s.preventDefault();if(e.length<2&&!0===this.option("panOnlyZoomed")&&this.content.width<=this.viewport.width&&this.content.height<=this.viewport.height&&this.transform.scale<=this.option("baseScale"))return;if(e.length>1&&(!this.option("zoom")||!1===this.option("pinchToZoom")))return;const o=getMidpoint(i[0],i[1]),n=getMidpoint(e[0],e[1]),h=n.clientX-o.clientX,a=n.clientY-o.clientY,r=getDistance(i[0],i[1]),c=getDistance(e[0],e[1]),l=r&&c?c/r:1;this.dragOffset.x+=h,this.dragOffset.y+=a,this.dragOffset.scale*=l,this.dragOffset.time=Date.now()-this.dragPosition.time;const d=1===this.dragStart.scale&&this.option("lockAxis");if(d&&!this.lockAxis){if(Math.abs(this.dragOffset.x)<6&&Math.abs(this.dragOffset.y)<6)return void s.preventDefault();const t=Math.abs(180*Math.atan2(this.dragOffset.y,this.dragOffset.x)/Math.PI);this.lockAxis=t>45&&t<135?"y":"x"}if("xy"===d||"y"!==this.lockAxis){if(s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation(),this.lockAxis&&(this.dragOffset["x"===this.lockAxis?"y":"x"]=0),this.$container.classList.add(this.option("draggingClass")),this.transform.scale===this.option("baseScale")&&"y"===this.lockAxis||(this.dragPosition.x=this.dragStart.x+this.dragOffset.x),this.transform.scale===this.option("baseScale")&&"x"===this.lockAxis||(this.dragPosition.y=this.dragStart.y+this.dragOffset.y),this.dragPosition.scale=this.dragStart.scale*this.dragOffset.scale,e.length>1){const i=getMidpoint(t.startPointers[0],t.startPointers[1]),e=i.clientX-this.dragStart.rect.x,s=i.clientY-this.dragStart.rect.y,{deltaX:o,deltaY:h}=this.getZoomDelta(this.content.scale*this.dragOffset.scale,e,s);this.dragPosition.x-=o,this.dragPosition.y-=h,this.dragPosition.midPoint=n}else this.setDragResistance();this.transform={x:this.dragPosition.x,y:this.dragPosition.y,scale:this.dragPosition.scale},this.startAnimation()}},end:(i,e)=>{if("pointerdown"!==this.state)return;if(this._dragOffset={...this.dragOffset},t.currentPointers.length)return void this.resetDragPosition();if(this.state="decel",this.friction=this.option("decelFriction"),this.recalculateTransform(),this.$container.classList.remove(this.option("draggingClass")),!1===this.trigger("touchEnd",e))return;if("decel"!==this.state)return;const s=this.option("minScale");if(this.transform.scale<s)return void this.zoomTo(s,{friction:.64});const o=this.option("maxScale");if(this.transform.scale-o>.01){const t=this.dragPosition.midPoint||i,e=this.$content.getClientRects()[0];this.zoomTo(o,{friction:.64,x:t.clientX-e.left,y:t.clientY-e.top})}else;}});this.pointerTracker=t}initObserver(){this.resizeObserver||(this.resizeObserver=new ResizeObserver((()=>{this.updateTimer||(this.updateTimer=setTimeout((()=>{const t=this.$container.getBoundingClientRect();t.width&&t.height?((Math.abs(t.width-this.container.width)>1||Math.abs(t.height-this.container.height)>1)&&(this.isAnimating()&&this.endAnimation(!0),this.updateMetrics(),this.panTo({x:this.content.x,y:this.content.y,scale:this.option("baseScale"),friction:0})),this.updateTimer=null):this.updateTimer=null}),this.updateRate))})),this.resizeObserver.observe(this.$container))}resetDragPosition(){this.lockAxis=null,this.friction=this.option("friction"),this.velocity={x:0,y:0,scale:0};const{x:t,y:i,scale:e}=this.content;this.dragStart={rect:this.$content.getBoundingClientRect(),x:t,y:i,scale:e},this.dragPosition={...this.dragPosition,x:t,y:i,scale:e},this.dragOffset={x:0,y:0,scale:1,time:0}}updateMetrics(t){!0!==t&&this.trigger("beforeUpdate");const i=this.$container,e=this.$content,s=this.$viewport,o=e instanceof HTMLImageElement,n=this.option("zoom"),h=this.option("resizeParent",n);let a=this.option("width"),r=this.option("height"),c=a||getFullWidth(e),l=r||getFullHeight(e);Object.assign(e.style,{width:a?`${a}px`:"",height:r?`${r}px`:"",maxWidth:"",maxHeight:""}),h&&Object.assign(s.style,{width:"",height:""});const d=this.option("ratio");c=round(c*d),l=round(l*d),a=c,r=l;const g=e.getBoundingClientRect(),m=s.getBoundingClientRect(),f=s==i?m:i.getBoundingClientRect();let p=Math.max(s.offsetWidth,round(m.width)),u=Math.max(s.offsetHeight,round(m.height)),x=window.getComputedStyle(s);if(p-=parseFloat(x.paddingLeft)+parseFloat(x.paddingRight),u-=parseFloat(x.paddingTop)+parseFloat(x.paddingBottom),this.viewport.width=p,this.viewport.height=u,n){if(Math.abs(c-g.width)>.1||Math.abs(l-g.height)>.1){const t=calculateAspectRatioFit(c,l,Math.min(c,g.width),Math.min(l,g.height));a=round(t.width),r=round(t.height)}Object.assign(e.style,{width:`${a}px`,height:`${r}px`,transform:""})}if(h&&(Object.assign(s.style,{width:`${a}px`,height:`${r}px`}),this.viewport={...this.viewport,width:a,height:r}),o&&n&&"function"!=typeof this.options.maxScale){const t=this.option("maxScale");this.options.maxScale=function(){return this.content.origWidth>0&&this.content.fitWidth>0?this.content.origWidth/this.content.fitWidth:t}}this.content={...this.content,origWidth:c,origHeight:l,fitWidth:a,fitHeight:r,width:a,height:r,scale:1,isZoomable:n},this.container={width:f.width,height:f.height},!0!==t&&this.trigger("afterUpdate")}zoomIn(t){this.zoomTo(this.content.scale+(t||this.option("step")))}zoomOut(t){this.zoomTo(this.content.scale-(t||this.option("step")))}toggleZoom(t={}){const i=this.option("maxScale"),e=this.option("baseScale"),s=this.content.scale>e+.5*(i-e)?e:i;this.zoomTo(s,t)}zoomTo(t=this.option("baseScale"),{x:i=null,y:e=null}={}){t=Math.max(Math.min(t,this.option("maxScale")),this.option("minScale"));const s=round(this.content.scale/(this.content.width/this.content.fitWidth),1e7);null===i&&(i=this.content.width*s*.5),null===e&&(e=this.content.height*s*.5);const{deltaX:o,deltaY:n}=this.getZoomDelta(t,i,e);i=this.content.x-o,e=this.content.y-n,this.panTo({x:i,y:e,scale:t,friction:this.option("zoomFriction")})}getZoomDelta(t,i=0,e=0){const s=this.content.fitWidth*this.content.scale,o=this.content.fitHeight*this.content.scale,n=i>0&&s?i/s:0,h=e>0&&o?e/o:0;return{deltaX:(this.content.fitWidth*t-s)*n,deltaY:(this.content.fitHeight*t-o)*h}}panTo({x:t=this.content.x,y:i=this.content.y,scale:e,friction:s=this.option("friction"),ignoreBounds:o=!1}={}){if(e=e||this.content.scale||1,!o){const{boundX:s,boundY:o}=this.getBounds(e);s&&(t=Math.max(Math.min(t,s.to),s.from)),o&&(i=Math.max(Math.min(i,o.to),o.from))}this.friction=s,this.transform={...this.transform,x:t,y:i,scale:e},s?(this.state="panning",this.velocity={x:(1/this.friction-1)*(t-this.content.x),y:(1/this.friction-1)*(i-this.content.y),scale:(1/this.friction-1)*(e-this.content.scale)},this.startAnimation()):this.endAnimation()}startAnimation(){this.rAF?cancelAnimationFrame(this.rAF):this.trigger("startAnimation"),this.rAF=requestAnimationFrame((()=>this.animate()))}animate(){if(this.setEdgeForce(),this.setDragForce(),this.velocity.x*=this.friction,this.velocity.y*=this.friction,this.velocity.scale*=this.friction,this.content.x+=this.velocity.x,this.content.y+=this.velocity.y,this.content.scale+=this.velocity.scale,this.isAnimating())this.setTransform();else if("pointerdown"!==this.state)return void this.endAnimation();this.rAF=requestAnimationFrame((()=>this.animate()))}getBounds(t){let i=this.boundX,e=this.boundY;if(void 0!==i&&void 0!==e)return{boundX:i,boundY:e};i={from:0,to:0},e={from:0,to:0},t=t||this.transform.scale;const s=this.content.fitWidth*t,o=this.content.fitHeight*t,n=this.viewport.width,h=this.viewport.height;if(s<n){const t=round(.5*(n-s));i.from=t,i.to=t}else i.from=round(n-s);if(o<h){const t=.5*(h-o);e.from=t,e.to=t}else e.from=round(h-o);return{boundX:i,boundY:e}}setEdgeForce(){if("decel"!==this.state)return;const t=this.option("bounceForce"),{boundX:i,boundY:e}=this.getBounds(Math.max(this.transform.scale,this.content.scale));let s,o,n,h;if(i&&(s=this.content.x<i.from,o=this.content.x>i.to),e&&(n=this.content.y<e.from,h=this.content.y>e.to),s||o){let e=((s?i.from:i.to)-this.content.x)*t;const o=this.content.x+(this.velocity.x+e)/this.friction;o>=i.from&&o<=i.to&&(e+=this.velocity.x),this.velocity.x=e,this.recalculateTransform()}if(n||h){let i=((n?e.from:e.to)-this.content.y)*t;const s=this.content.y+(i+this.velocity.y)/this.friction;s>=e.from&&s<=e.to&&(i+=this.velocity.y),this.velocity.y=i,this.recalculateTransform()}}setDragResistance(){if("pointerdown"!==this.state)return;const{boundX:t,boundY:i}=this.getBounds(this.dragPosition.scale);let e,s,o,n;if(t&&(e=this.dragPosition.x<t.from,s=this.dragPosition.x>t.to),i&&(o=this.dragPosition.y<i.from,n=this.dragPosition.y>i.to),(e||s)&&(!e||!s)){const i=e?t.from:t.to,s=i-this.dragPosition.x;this.dragPosition.x=i-.3*s}if((o||n)&&(!o||!n)){const t=o?i.from:i.to,e=t-this.dragPosition.y;this.dragPosition.y=t-.3*e}}setDragForce(){"pointerdown"===this.state&&(this.velocity.x=this.dragPosition.x-this.content.x,this.velocity.y=this.dragPosition.y-this.content.y,this.velocity.scale=this.dragPosition.scale-this.content.scale)}recalculateTransform(){this.transform.x=this.content.x+this.velocity.x/(1/this.friction-1),this.transform.y=this.content.y+this.velocity.y/(1/this.friction-1),this.transform.scale=this.content.scale+this.velocity.scale/(1/this.friction-1)}isAnimating(){return!(!this.friction||!(Math.abs(this.velocity.x)>.05||Math.abs(this.velocity.y)>.05||Math.abs(this.velocity.scale)>.05))}setTransform(t){let i,e,s;if(t?(i=round(this.transform.x),e=round(this.transform.y),s=this.transform.scale,this.content={...this.content,x:i,y:e,scale:s}):(i=round(this.content.x),e=round(this.content.y),s=this.content.scale/(this.content.width/this.content.fitWidth),this.content={...this.content,x:i,y:e}),this.trigger("beforeTransform"),i=round(this.content.x),e=round(this.content.y),t&&this.option("zoom")){let t,o;t=round(this.content.fitWidth*s),o=round(this.content.fitHeight*s),this.content.width=t,this.content.height=o,this.transform={...this.transform,width:t,height:o,scale:s},Object.assign(this.$content.style,{width:`${t}px`,height:`${o}px`,maxWidth:"none",maxHeight:"none",transform:`translate3d(${i}px, ${e}px, 0) scale(1)`})}else this.$content.style.transform=`translate3d(${i}px, ${e}px, 0) scale(${s})`;this.trigger("afterTransform")}endAnimation(t){cancelAnimationFrame(this.rAF),this.rAF=null,this.velocity={x:0,y:0,scale:0},this.setTransform(!0),this.state="ready",this.handleCursor(),!0!==t&&this.trigger("endAnimation")}handleCursor(){const t=this.option("draggableClass");t&&this.option("touch")&&(1==this.option("panOnlyZoomed")&&this.content.width<=this.viewport.width&&this.content.height<=this.viewport.height&&this.transform.scale<=this.option("baseScale")?this.$container.classList.remove(t):this.$container.classList.add(t))}detachEvents(){this.$content.removeEventListener("load",this.onLoad),this.$container.removeEventListener("wheel",this.onWheel,{passive:!1}),this.$container.removeEventListener("click",this.onClick,{passive:!1}),this.pointerTracker&&(this.pointerTracker.stop(),this.pointerTracker=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}destroy(){"destroy"!==this.state&&(this.state="destroy",clearTimeout(this.updateTimer),this.updateTimer=null,cancelAnimationFrame(this.rAF),this.rAF=null,this.detachEvents(),this.detachPlugins(),this.resetDragPosition())}}Panzoom.version="__VERSION__",Panzoom.Plugins=Plugins;
//# sourceMappingURL=/sm/8b035dc6764666efb7821b0bf8e7c91ac9739da088ae0bf65ab09aa356f3d7ee.map
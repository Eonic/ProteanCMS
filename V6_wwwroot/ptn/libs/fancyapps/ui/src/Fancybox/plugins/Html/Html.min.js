/**
 * Minified by jsDelivr using Terser v5.13.1.
 * Original file: /npm/@fancyapps/ui@4.0.27/src/Fancybox/plugins/Html/Html.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{extend}from"../../../shared/utils/extend.js";const buildURLQuery=(e,t)=>{const o=new URL(e),i=new URLSearchParams(o.search);let s=new URLSearchParams;for(const[e,o]of[...i,...Object.entries(t)])"t"===e?s.set("start",parseInt(o)):s.set(e,o);s=s.toString();let a=e.match(/#t=((.*)?\d+s)/);return a&&(s+=`#t=${a[1]}`),s},defaults={video:{autoplay:!0,ratio:16/9},youtube:{autohide:1,fs:1,rel:0,hd:1,wmode:"transparent",enablejsapi:1,html5:1},vimeo:{hd:1,show_title:1,show_byline:1,show_portrait:0,fullscreen:1},html5video:{tpl:'<video class="fancybox__html5video" playsinline controls controlsList="nodownload" poster="{{poster}}">\n  <source src="{{src}}" type="{{format}}" />Sorry, your browser doesn\'t support embedded videos.</video>',format:""}};export class Html{constructor(e){this.fancybox=e;for(const e of["onInit","onReady","onCreateSlide","onRemoveSlide","onSelectSlide","onUnselectSlide","onRefresh","onMessage"])this[e]=this[e].bind(this);this.events={init:this.onInit,ready:this.onReady,"Carousel.createSlide":this.onCreateSlide,"Carousel.removeSlide":this.onRemoveSlide,"Carousel.selectSlide":this.onSelectSlide,"Carousel.unselectSlide":this.onUnselectSlide,"Carousel.refresh":this.onRefresh}}onInit(){for(const e of this.fancybox.items)this.processType(e)}processType(e){if(e.html)return e.src=e.html,e.type="html",void delete e.html;const t=e.src||"";let o=e.type||this.fancybox.options.type,i=null;if(!t||"string"==typeof t){if(i=t.match(/(?:youtube\.com|youtu\.be|youtube\-nocookie\.com)\/(?:watch\?(?:.*&)?v=|v\/|u\/|embed\/?)?(videoseries\?list=(?:.*)|[\w-]{11}|\?listType=(?:.*)&list=(?:.*))(?:.*)/i)){const s=buildURLQuery(t,this.fancybox.option("Html.youtube")),a=encodeURIComponent(i[1]);e.videoId=a,e.src=`https://www.youtube-nocookie.com/embed/${a}?${s}`,e.thumb=e.thumb||`https://i.ytimg.com/vi/${a}/mqdefault.jpg`,e.vendor="youtube",o="video"}else if(i=t.match(/^.+vimeo.com\/(?:\/)?([\d]+)(.*)?/)){const s=buildURLQuery(t,this.fancybox.option("Html.vimeo")),a=encodeURIComponent(i[1]);e.videoId=a,e.src=`https://player.vimeo.com/video/${a}?${s}`,e.vendor="vimeo",o="video"}else(i=t.match(/(?:maps\.)?google\.([a-z]{2,3}(?:\.[a-z]{2})?)\/(?:(?:(?:maps\/(?:place\/(?:.*)\/)?\@(.*),(\d+.?\d+?)z))|(?:\?ll=))(.*)?/i))?(e.src=`//maps.google.${i[1]}/?ll=${(i[2]?i[2]+"&z="+Math.floor(i[3])+(i[4]?i[4].replace(/^\//,"&"):""):i[4]+"").replace(/\?/,"&")}&output=${i[4]&&i[4].indexOf("layer=c")>0?"svembed":"embed"}`,o="map"):(i=t.match(/(?:maps\.)?google\.([a-z]{2,3}(?:\.[a-z]{2})?)\/(?:maps\/search\/)(.*)/i))&&(e.src=`//maps.google.${i[1]}/maps?q=${i[2].replace("query=","q=").replace("api=1","")}&output=embed`,o="map");o||("#"===t.charAt(0)?o="inline":(i=t.match(/\.(mp4|mov|ogv|webm)((\?|#).*)?$/i))?(o="html5video",e.format=e.format||"video/"+("ogv"===i[1]?"ogg":i[1])):t.match(/(^data:image\/[a-z0-9+\/=]*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg|ico)((\?|#).*)?$)/i)?o="image":t.match(/\.(pdf)((\?|#).*)?$/i)&&(o="pdf")),e.type=o||this.fancybox.option("defaultType","image"),"html5video"!==o&&"video"!==o||(e.video=extend({},this.fancybox.option("Html.video"),e.video),e._width&&e._height?e.ratio=parseFloat(e._width)/parseFloat(e._height):e.ratio=e.ratio||e.video.ratio||defaults.video.ratio)}}onReady(){this.fancybox.Carousel.slides.forEach((e=>{e.$el&&(this.setContent(e),e.index===this.fancybox.getSlide().index&&this.playVideo(e))}))}onCreateSlide(e,t,o){"ready"===this.fancybox.state&&this.setContent(o)}loadInlineContent(e){let t;if(e.src instanceof HTMLElement)t=e.src;else if("string"==typeof e.src){const o=e.src.split("#",2),i=2===o.length&&""===o[0]?o[1]:o[0];t=document.getElementById(i)}if(t){if("clone"===e.type||t.$placeHolder){t=t.cloneNode(!0);let o=t.getAttribute("id");o=o?`${o}--clone`:`clone-${this.fancybox.id}-${e.index}`,t.setAttribute("id",o)}else{const e=document.createElement("div");e.classList.add("fancybox-placeholder"),t.parentNode.insertBefore(e,t),t.$placeHolder=e}this.fancybox.setContent(e,t)}else this.fancybox.setError(e,"{{ELEMENT_NOT_FOUND}}")}loadAjaxContent(e){const t=this.fancybox,o=new XMLHttpRequest;t.showLoading(e),o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&"ready"===t.state&&(t.hideLoading(e),200===o.status?t.setContent(e,o.responseText):t.setError(e,404===o.status?"{{AJAX_NOT_FOUND}}":"{{AJAX_FORBIDDEN}}"))};const i=e.ajax||null;o.open(i?"POST":"GET",e.src),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.send(i),e.xhr=o}loadIframeContent(e){const t=this.fancybox,o=document.createElement("iframe");if(o.className="fancybox__iframe",o.setAttribute("id",`fancybox__iframe_${t.id}_${e.index}`),o.setAttribute("allow","autoplay; fullscreen"),o.setAttribute("scrolling","auto"),e.$iframe=o,"iframe"!==e.type||!1===e.preload)return o.setAttribute("src",e.src),this.fancybox.setContent(e,o),void this.resizeIframe(e);t.showLoading(e);const i=document.createElement("div");i.style.visibility="hidden",this.fancybox.setContent(e,i),i.appendChild(o),o.onerror=()=>{t.setError(e,"{{IFRAME_ERROR}}")},o.onload=()=>{t.hideLoading(e);let i=!1;o.isReady||(o.isReady=!0,i=!0),o.src.length&&(o.parentNode.style.visibility="",this.resizeIframe(e),i&&t.revealContent(e))},o.setAttribute("src",e.src)}setAspectRatio(e){const t=e.$content,o=e.ratio;if(!t)return;let i=e._width,s=e._height;if(o||i&&s){Object.assign(t.style,{width:i&&s?"100%":"",height:i&&s?"100%":"",maxWidth:"",maxHeight:""});let e=t.offsetWidth,a=t.offsetHeight;if(i=i||e,s=s||a,i>e||s>a){let t=Math.min(e/i,a/s);i*=t,s*=t}Math.abs(i/s-o)>.01&&(o<i/s?i=s*o:s=i/o),Object.assign(t.style,{width:`${i}px`,height:`${s}px`})}}resizeIframe(e){const t=e.$iframe;if(!t)return;let o=e._width||0,i=e._height||0;o&&i&&(e.autoSize=!1);const s=t.parentNode,a=s&&s.style;if(!1!==e.preload&&!1!==e.autoSize&&a)try{const e=window.getComputedStyle(s),n=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight),r=parseFloat(e.paddingTop)+parseFloat(e.paddingBottom),l=t.contentWindow.document,d=l.getElementsByTagName("html")[0],c=l.body;a.width="",c.style.overflow="hidden",o=o||d.scrollWidth+n,a.width=`${o}px`,c.style.overflow="",a.flex="0 0 auto",a.height=`${c.scrollHeight}px`,i=d.scrollHeight+r}catch(e){}if(o||i){const e={flex:"0 1 auto"};o&&(e.width=`${o}px`),i&&(e.height=`${i}px`),Object.assign(a,e)}}onRefresh(e,t){t.slides.forEach((e=>{e.$el&&(e.$iframe&&this.resizeIframe(e),e.ratio&&this.setAspectRatio(e))}))}setContent(e){if(e&&!e.isDom){switch(e.type){case"html":this.fancybox.setContent(e,e.src);break;case"html5video":this.fancybox.setContent(e,this.fancybox.option("Html.html5video.tpl").replace(/\{\{src\}\}/gi,e.src).replace("{{format}}",e.format||e.html5video&&e.html5video.format||"").replace("{{poster}}",e.poster||e.thumb||""));break;case"inline":case"clone":this.loadInlineContent(e);break;case"ajax":this.loadAjaxContent(e);break;case"pdf":case"video":case"map":e.preload=!1;case"iframe":this.loadIframeContent(e)}e.ratio&&this.setAspectRatio(e)}}onSelectSlide(e,t,o){"ready"===e.state&&this.playVideo(o)}playVideo(e){if("html5video"===e.type&&e.video.autoplay)try{const t=e.$el.querySelector("video");if(t){const e=t.play();void 0!==e&&e.then((()=>{})).catch((e=>{t.muted=!0,t.play()}))}}catch(e){}if("video"!==e.type||!e.$iframe||!e.$iframe.contentWindow)return;const t=()=>{if("done"===e.state&&e.$iframe&&e.$iframe.contentWindow){let t;if(e.$iframe.isReady)return e.video&&e.video.autoplay&&(t="youtube"==e.vendor?{event:"command",func:"playVideo"}:{method:"play",value:"true"}),void(t&&e.$iframe.contentWindow.postMessage(JSON.stringify(t),"*"));"youtube"===e.vendor&&(t={event:"listening",id:e.$iframe.getAttribute("id")},e.$iframe.contentWindow.postMessage(JSON.stringify(t),"*"))}e.poller=setTimeout(t,250)};t()}onUnselectSlide(e,t,o){if("html5video"===o.type){try{o.$el.querySelector("video").pause()}catch(e){}return}let i=!1;"vimeo"==o.vendor?i={method:"pause",value:"true"}:"youtube"===o.vendor&&(i={event:"command",func:"pauseVideo"}),i&&o.$iframe&&o.$iframe.contentWindow&&o.$iframe.contentWindow.postMessage(JSON.stringify(i),"*"),clearTimeout(o.poller)}onRemoveSlide(e,t,o){o.xhr&&(o.xhr.abort(),o.xhr=null),o.$iframe&&(o.$iframe.onload=o.$iframe.onerror=null,o.$iframe.src="//about:blank",o.$iframe=null);const i=o.$content;"inline"===o.type&&i&&(i.classList.remove("fancybox__content"),"none"!==i.style.display&&(i.style.display="none")),o.$closeButton&&(o.$closeButton.remove(),o.$closeButton=null);const s=i&&i.$placeHolder;s&&(s.parentNode.insertBefore(i,s),s.remove(),i.$placeHolder=null)}onMessage(e){try{let t=JSON.parse(e.data);if("https://player.vimeo.com"===e.origin){if("ready"===t.event)for(let t of document.getElementsByClassName("fancybox__iframe"))t.contentWindow===e.source&&(t.isReady=1)}else"https://www.youtube-nocookie.com"===e.origin&&"onReady"===t.event&&(document.getElementById(t.id).isReady=1)}catch(e){}}attach(){this.fancybox.on(this.events),window.addEventListener("message",this.onMessage,!1)}detach(){this.fancybox.off(this.events),window.removeEventListener("message",this.onMessage,!1)}}Html.defaults=defaults;
//# sourceMappingURL=/sm/3e85c9c05a4c9c987732dcd960011a6e4149550bbc72f29823b1971da812836c.map
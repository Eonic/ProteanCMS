/**
 * Minified by jsDelivr using Terser v5.13.1.
 * Original file: /npm/@fancyapps/ui@4.0.27/src/Fancybox/plugins/Image/Image.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{extend}from"../../../shared/utils/extend.js";import{Panzoom}from"../../../Panzoom/Panzoom.js";const defaults={canZoomInClass:"can-zoom_in",canZoomOutClass:"can-zoom_out",zoom:!0,zoomOpacity:"auto",zoomFriction:.82,ignoreCoveredThumbnail:!1,touch:!0,click:"toggleZoom",doubleClick:null,wheel:"zoom",fit:"contain",wrap:!1,Panzoom:{ratio:1}};export class Image{constructor(o){this.fancybox=o;for(const o of["onReady","onClosing","onDone","onPageChange","onCreateSlide","onRemoveSlide","onImageStatusChange"])this[o]=this[o].bind(this);this.events={ready:this.onReady,closing:this.onClosing,done:this.onDone,"Carousel.change":this.onPageChange,"Carousel.createSlide":this.onCreateSlide,"Carousel.removeSlide":this.onRemoveSlide}}onReady(){this.fancybox.Carousel.slides.forEach((o=>{o.$el&&this.setContent(o)}))}onDone(o,t){this.handleCursor(t)}onClosing(o){clearTimeout(this.clickTimer),this.clickTimer=null,o.Carousel.slides.forEach((o=>{o.$image&&(o.state="destroy"),o.Panzoom&&o.Panzoom.detachEvents()})),"closing"===this.fancybox.state&&this.canZoom(o.getSlide())&&this.zoomOut()}onCreateSlide(o,t,e){"ready"===this.fancybox.state&&this.setContent(e)}onRemoveSlide(o,t,e){e.$image&&(e.$el.classList.remove(o.option("Image.canZoomInClass")),e.$image.remove(),e.$image=null),e.Panzoom&&(e.Panzoom.destroy(),e.Panzoom=null),e.$el&&e.$el.dataset&&delete e.$el.dataset.imageFit}setContent(o){if(o.isDom||o.html||o.type&&"image"!==o.type)return;if(o.$image)return;o.type="image",o.state="loading";const t=document.createElement("div");t.style.visibility="hidden";const e=document.createElement("img");e.addEventListener("load",(t=>{t.stopImmediatePropagation(),this.onImageStatusChange(o)})),e.addEventListener("error",(()=>{this.onImageStatusChange(o)})),e.src=o.src,e.alt="",e.draggable=!1,e.classList.add("fancybox__image"),o.srcset&&e.setAttribute("srcset",o.srcset),o.sizes&&e.setAttribute("sizes",o.sizes),o.$image=e;const n=this.fancybox.option("Image.wrap");if(n){const i=document.createElement("div");i.classList.add("string"==typeof n?n:"fancybox__image-wrap"),i.appendChild(e),t.appendChild(i),o.$wrap=i}else t.appendChild(e);o.$el.dataset.imageFit=this.fancybox.option("Image.fit"),this.fancybox.setContent(o,t),e.complete||e.error?this.onImageStatusChange(o):this.fancybox.showLoading(o)}onImageStatusChange(o){const t=o.$image;t&&"loading"===o.state&&(t.complete&&t.naturalWidth&&t.naturalHeight?(this.fancybox.hideLoading(o),"contain"===this.fancybox.option("Image.fit")&&this.initSlidePanzoom(o),o.$el.addEventListener("wheel",(t=>this.onWheel(o,t)),{passive:!1}),o.$content.addEventListener("click",(t=>this.onClick(o,t)),{passive:!1}),this.revealContent(o)):this.fancybox.setError(o,"{{IMAGE_ERROR}}"))}initSlidePanzoom(o){o.Panzoom||(o.Panzoom=new Panzoom(o.$el,extend(!0,this.fancybox.option("Image.Panzoom",{}),{viewport:o.$wrap,content:o.$image,width:o._width,height:o._height,wrapInner:!1,textSelection:!0,touch:this.fancybox.option("Image.touch"),panOnlyZoomed:!0,click:!1,wheel:!1})),o.Panzoom.on("startAnimation",(()=>{this.fancybox.trigger("Image.startAnimation",o)})),o.Panzoom.on("endAnimation",(()=>{"zoomIn"===o.state&&this.fancybox.done(o),this.handleCursor(o),this.fancybox.trigger("Image.endAnimation",o)})),o.Panzoom.on("afterUpdate",(()=>{this.handleCursor(o),this.fancybox.trigger("Image.afterUpdate",o)})))}revealContent(o){null===this.fancybox.Carousel.prevPage&&o.index===this.fancybox.options.startIndex&&this.canZoom(o)?this.zoomIn():this.fancybox.revealContent(o)}getZoomInfo(o){const t=o.$thumb.getBoundingClientRect(),e=t.width,n=t.height,i=o.$content.getBoundingClientRect(),a=i.width,s=i.height,c=i.top-t.top,l=i.left-t.left;let r=this.fancybox.option("Image.zoomOpacity");return"auto"===r&&(r=Math.abs(e/n-a/s)>.1),{top:c,left:l,scale:a&&e?e/a:1,opacity:r}}canZoom(o){const t=this.fancybox,e=t.$container;if(window.visualViewport&&1!==window.visualViewport.scale)return!1;if(o.Panzoom&&!o.Panzoom.content.width)return!1;if(!t.option("Image.zoom")||"contain"!==t.option("Image.fit"))return!1;const n=o.$thumb;if(!n||"loading"===o.state)return!1;e.classList.add("fancybox__no-click");const i=n.getBoundingClientRect();let a;if(this.fancybox.option("Image.ignoreCoveredThumbnail")){const o=document.elementFromPoint(i.left+1,i.top+1)===n,t=document.elementFromPoint(i.right-1,i.bottom-1)===n;a=o&&t}else a=document.elementFromPoint(i.left+.5*i.width,i.top+.5*i.height)===n;return e.classList.remove("fancybox__no-click"),a}zoomIn(){const o=this.fancybox,t=o.getSlide(),e=t.Panzoom,{top:n,left:i,scale:a,opacity:s}=this.getZoomInfo(t);o.trigger("reveal",t),e.panTo({x:-1*i,y:-1*n,scale:a,friction:0,ignoreBounds:!0}),t.$content.style.visibility="",t.state="zoomIn",!0===s&&e.on("afterTransform",(o=>{"zoomIn"!==t.state&&"zoomOut"!==t.state||(o.$content.style.opacity=Math.min(1,1-(1-o.content.scale)/(1-a)))})),e.panTo({x:0,y:0,scale:1,friction:this.fancybox.option("Image.zoomFriction")})}zoomOut(){const o=this.fancybox,t=o.getSlide(),e=t.Panzoom;if(!e)return;t.state="zoomOut",o.state="customClosing",t.$caption&&(t.$caption.style.visibility="hidden");let n=this.fancybox.option("Image.zoomFriction");const i=o=>{const{top:i,left:a,scale:s,opacity:c}=this.getZoomInfo(t);o||c||(n*=.82),e.panTo({x:-1*a,y:-1*i,scale:s,friction:n,ignoreBounds:!0}),n*=.98};window.addEventListener("scroll",i),e.once("endAnimation",(()=>{window.removeEventListener("scroll",i),o.destroy()})),i()}handleCursor(o){if("image"!==o.type||!o.$el)return;const t=o.Panzoom,e=this.fancybox.option("Image.click",!1,o),n=this.fancybox.option("Image.touch"),i=o.$el.classList,a=this.fancybox.option("Image.canZoomInClass"),s=this.fancybox.option("Image.canZoomOutClass");if(i.remove(s),i.remove(a),t&&"toggleZoom"===e){t&&1===t.content.scale&&t.option("maxScale")-t.content.scale>.01?i.add(a):t.content.scale>1&&!n&&i.add(s)}else"close"===e&&i.add(s)}onWheel(o,t){if("ready"===this.fancybox.state&&!1!==this.fancybox.trigger("Image.wheel",t))switch(this.fancybox.option("Image.wheel")){case"zoom":"done"===o.state&&o.Panzoom&&o.Panzoom.zoomWithWheel(t);break;case"close":this.fancybox.close();break;case"slide":this.fancybox[t.deltaY<0?"prev":"next"]()}}onClick(o,t){if("ready"!==this.fancybox.state)return;const e=o.Panzoom;if(e&&(e.dragPosition.midPoint||0!==e.dragOffset.x||0!==e.dragOffset.y||1!==e.dragOffset.scale))return;if(this.fancybox.Carousel.Panzoom.lockAxis)return!1;const n=e=>{switch(e){case"toggleZoom":t.stopPropagation(),o.Panzoom&&o.Panzoom.zoomWithClick(t);break;case"close":this.fancybox.close();break;case"next":t.stopPropagation(),this.fancybox.next()}},i=this.fancybox.option("Image.click"),a=this.fancybox.option("Image.doubleClick");a?this.clickTimer?(clearTimeout(this.clickTimer),this.clickTimer=null,n(a)):this.clickTimer=setTimeout((()=>{this.clickTimer=null,n(i)}),300):n(i)}onPageChange(o,t){const e=o.getSlide();t.slides.forEach((o=>{o.Panzoom&&"done"===o.state&&o.index!==e.index&&o.Panzoom.panTo({x:0,y:0,scale:1,friction:.8})}))}attach(){this.fancybox.on(this.events)}detach(){this.fancybox.off(this.events)}}Image.defaults=defaults;
//# sourceMappingURL=/sm/1974c1073220c3f092f11ba83bcca1e0b55e882a2caf63d531cef98559440b73.map
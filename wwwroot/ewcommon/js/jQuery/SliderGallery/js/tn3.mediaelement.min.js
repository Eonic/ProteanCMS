/*!
 * tn3 mediaelemnt plugin v1.4.0.93
 * http://tn3gallery.com/
 *
 * License
 * http://tn3gallery.com/license
 *
 * Date: 15 Feb, 2013 13:23:03 +0200
 */
(function(b){b.fn.tn3.plugIn("mediaelement",function(a,c){b.each(c.content,function(f,d){d.plugin=="mediaelement"&&new e(d.options,a)})});var e=b.fn.tn3.mediaelement=function(a,c){this.config=b.extend(true,{},e.config,a);this.slideshowPlay=this.config.slideshowPlay;delete this.config.slideshowPlay;var f=this;this.config.success=function(d){f.onMediaSuccess.call(f,d);a.success&&a.success.call(this,d)};this.init(c)};e.config={features:["current","progress","duration"],useFullScreen:false,enableKeyboard:false,
slideshowPlay:true};e.prototype={config:null,$c:null,tn3:null,mep:null,tn3Index:null,isLoaded:false,tn3WasPlaying:null,currentTime:null,resizeID:null,autoplayID:null,stretch:true,slideshowPlay:true,init:function(a){this.$c=a;this.tn3=this.$c.data("tn3");a.bind("tn3_rebuild",b.proxy(this.rebuild,this));a.bind("tn3_rebuild_start",b.proxy(this.rebuild_start,this))},rebuild:function(a){a=a.source.imager;a.$c.bind("img_load_start",b.proxy(this.nextLoadStart,this));a.$c.bind("img_load_end",b.proxy(this.loadEnd,
this));this.$c.unbind("tn3_rebuild",b.proxy(this.rebuild,this));this.stretch=a.config.stretch;a.active!=-1&&!a.cached[a.active].isImage&&this.loadEnd({n:a.active,isImage:false,content:a.cached[a.active].$content})},onMediaSuccess:function(){this.mep&&this.initOnLoad();this.isLoaded=true},loadEnd:function(a){if(!a.isImage&&a.content[0].tagName.toLowerCase()=="video"){this.tn3Index=a.n;this.initME();this.tn3.items.play&&this.tn3.items.play.attr("title",this.tn3.t("Play Video"))}},initME:function(){this.mep&&
this.removeME();var a=this.tn3.imager.cached[this.tn3.imager.active].$content;this.stretch&&a.attr("width",this.tn3.imager.$c.width()).attr("height",this.tn3.imager.$c.height());this.mep=new MediaElementPlayer(a,this.config);this.$c.bind("tn3_control",b.proxy(this.control,this));this.$c.bind("tn3_fullscreen",b.proxy(this.fullscreen,this));this.isLoaded&&this.initOnLoad()},initOnLoad:function(){this.mep.media.addEventListener("play",b.proxy(this.onVideoPlay,this),false);this.mep.media.addEventListener("pause",
b.proxy(this.onVideoPause,this),false);this.mep.media.addEventListener("ended",b.proxy(this.onVideoEnd,this),false);this.mep.media.addEventListener("loadeddata",b.proxy(this.onVideoLoad,this),false);this.mep.media.addEventListener("loadedmetadata",b.proxy(this.onVideoLoad,this),false);this.tn3WasPlaying=this.tn3.isPlaying;if(this.slideshowPlay)if(this.tn3.isPlaying){this.tn3.isPlaying=false;this.tn3.timer.stop();setTimeout(b.proxy(this.playFromCurrent,this),300)}if(this.stretch){this.tn3.imager.$c.bind("img_resize",
b.proxy(this.resize,this));this.resize()}},nextLoadStart:function(){if(this.mep){if(this.slideshowPlay&&this.tn3WasPlaying){this.tn3.isPlaying=true;this.onVideoPlay()}else this.onVideoPause();this.removeME();this.tn3.imager.destroy();this.tn3.imager.$active.find(".mejs-container").remove()}},removeME:function(){clearTimeout(this.resizeID);this.removeEvents();this.tn3.items.play&&this.tn3.items.play.attr("title",this.tn3.t("Start Slideshow"));this.mep.media.remove&&this.mep.media.remove();this.mep.media.pluginApi=
null;this.mep.remove();this.mep=null;this.isLoaded=false;this.tn3.imager.destroy();this.tn3.imager.rebuild(this.tn3.imager.data)},removeEvents:function(){this.mep.container.unbind(mejs.MediaFeatures.fullScreenEventName,b.proxy(this.onMEFullScreen,this));this.mep.media.removeEventListener("play",b.proxy(this.onVideoPlay,this));this.mep.media.removeEventListener("pause",b.proxy(this.onVideoPause,this));this.mep.media.removeEventListener("ended",b.proxy(this.onVideoEnd,this));this.mep.media.removeEventListener("loadeddata",
b.proxy(this.onVideoLoad,this));this.mep.media.removeEventListener("loadedmetadata",b.proxy(this.onVideoLoad,this));this.tn3.imager.$c.unbind("img_resize",b.proxy(this.resize,this));this.$c.unbind("tn3_control",b.proxy(this.control,this));this.$c.unbind("tn3_fullscreen",b.proxy(this.fullscreen,this))},onVideoPlay:function(){if(this.tn3.items.play){this.tn3.items.play.addClass(this.tn3.config.cssID+"-play-active");this.tn3.items.play.attr("title",this.tn3.t("Pause Video"))}if(!this.slideshowPlay&&
this.tn3.isPlaying){this.tn3WasPlaying=true;this.tn3.isPlaying=false;this.tn3.timer.stop()}},onVideoPause:function(){if(this.tn3.items.play){this.tn3.items.play.removeClass(this.tn3.config.cssID+"-play-active");this.tn3.items.play.attr("title",this.tn3.t("Play Video"))}},onVideoEnd:function(){if(this.tn3WasPlaying){this.tn3.isPlaying=true;this.tn3.trigger("timer_end")}},resize:function(){if(this.stretch){var a=this.mep;a.width=this.tn3.imager.$c.width();a.height=this.tn3.imager.$c.height();this.mep.container.find("video").attr("width",
a.width).attr("height",a.height);this.mep.container.find("object,embed").attr("width",a.width).attr("height",a.height);a.setPlayerSize(a.width,a.height);a.setControlsSize();this.onVideoLoad()}},onVideoLoad:function(){if(!this.isLoaded||!this.mep.media||this.mep.media.pluginType!="native"&&!this.mep.media.pluginApi){clearTimeout(this.resizeID);this.resizeID=setTimeout(b.proxy(this.onVideoLoad,this),300)}else this.resizeWhenReady()},resizeWhenReady:function(){if(this.stretch){this.mep.width=this.tn3.imager.$c.width();
this.mep.height=this.tn3.imager.$c.height();this.mep.setPlayerSize(this.mep.width,this.mep.height);this.mep.setControlsSize();b(this.mep.media.pluginApi).attr("width",this.mep.width).attr("height",this.mep.height);this.currentTime!=null&&this.playFromCurrent()}else{this.mep.setPlayerSize(this.mep.width,this.mep.height);this.playFromCurrent()}},playFromCurrent:function(){if(this.currentTime!==null){if(this.mep.media.pluginType!="native"&&!this.mep.media.pluginApi.seekTo){clearTimeout(this.resizeID);
this.resizeID=setTimeout(b.proxy(this.playFromCurrent,this),300);return}this.mep.setCurrentTime(this.currentTime);this.currentTime=null;this.mep.play()}this.mep.play()},fullscreen:function(){if(!this.mep){this.$c.unbind("tn3_fullscreen",b.proxy(this.fullscreen,this));this.tn3.imager.rebuild(this.tn3.imager.data);this.tn3.imager.show(this.tn3Index)}},control:function(a){var c=this.mep;if(a.id=="fullscreen")if(this.config.useFullScreen&&!a.source.config.isFullScreen){a.execute=false;c.enterFullScreen();
this.config.useFullScreen&&mejs.MediaFeatures.hasTrueNativeFullScreen&&this.mep.container.bind(mejs.MediaFeatures.fullScreenEventName,b.proxy(this.onMEFullScreen,this))}else{if(!this.mep.media.paused){this.currentTime=this.mep.media.currentTime;this.mep.pause()}a.source.imager.$c.unbind("img_resize",b.proxy(this.resize,this));a.source.imager.$c.bind("img_resize",b.proxy(this.resize,this));if(this.mep.media.pluginType!="native"){this.removeME();this.$c.bind("tn3_fullscreen",b.proxy(this.fullscreen,
this));a.execute=false;setTimeout(b.proxy(this.tn3.fullscreen,this.tn3),50)}}else if(a.id=="play"){a.execute=false;(this.tn3WasPlaying=c.media.paused)?c.play():c.pause()}},onMEFullScreen:function(){if(!mejs.MediaFeatures.isFullScreen()){this.resize();this.mep.container.css("position","static")}}}})(jQuery);

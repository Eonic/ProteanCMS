/*!
 * tn3 flickr plugin v1.4.0.93
 * http://tn3gallery.com/
 *
 * License
 * http://tn3gallery.com/license
 *
 * Date: 15 Feb, 2013 13:23:03 +0200
 */
(function(f){var j=f.fn.tn3.External;j.flickr=function(b,d){this.config=f.extend(true,{},j.flickr.config,b);this.extcon=d;if(b.noInit)d.reqs--;else this.init()};j.flickr.config={api_key:"",user_id:"",source:"search",photos:{extras:"description,media",page:1,per_page:20,media:"photos"},photoset_id:"",gallery_id:"",albums:{},albumInfo:{},thumbSize:"s",imageSize:"z"};j.flickr.prototype={config:null,extcon:null,init:function(){this.getAlbums()},getAlbums:function(){var b={user_id:this.config.user_id};
switch(this.config.source){case "galleries":if(this.config.gallery_id!=""){b.gallery_id=this.config.gallery_id;b.method="flickr.galleries.getInfo"}else b.method="flickr.galleries.getList";break;case "sets":if(this.config.photoset_id!=""){b.photoset_id=this.config.photoset_id;b.method="flickr.photosets.getInfo"}else b.method="flickr.photosets.getList";break;default:b={title:this.config.source,adata:{origin:"flickr"}};f.extend(b,this.config.albumInfo);this.extcon.setAlbumData([b]);return}b=f.extend(b,
this.config.albums);this.request(b)},getImages:function(b,d){var a={};switch(this.config.source){case "galleries":a.method="flickr.galleries.getPhotos";a.gallery_id=b.id;break;case "sets":a.method="flickr.photosets.getPhotos";a.photoset_id=b.id;break;case "favorites":a.method="flickr.favorites.getPublicList";a.user_id=this.config.user_id;break;case "interestingness":a.method="flickr.interestingness.getList";a.user_id=this.config.user_id;break;case "photostream":a.method="flickr.people.getPublicPhotos";
a.user_id=this.config.user_id;break;case "search":a.method="flickr.photos.search";a.user_id=this.config.user_id}a=f.extend(a,this.config.photos);this.request(a,b,d)},request:function(b,d,a){b.api_key=this.config.api_key;b.format="json";f.ajax({url:"http://api.flickr.com/services/rest/?",type:"GET",dataType:"jsonp",cache:false,context:this,jsonp:"jsoncallback",success:function(c){if(c.stat=="fail"){c="flickr: "+c.message;a===undefined?this.extcon.setAlbumData([],c):this.extcon.setImageData([],a,c)}else switch(b.method){case "flickr.galleries.getInfo":this.parseGalleryInfo(c);
break;case "flickr.galleries.getList":this.parseGalleries(c);break;case "flickr.photosets.getInfo":this.parseSetInfo(c);break;case "flickr.photosets.getList":this.parsePhotosets(c);break;case "flickr.photosets.getPhotos":this.parsePhotoset(c,d,a);break;default:this.parsePhotos(c,a)}},error:function(){a===undefined?this.extcon.setAlbumData([],"flickr: api call failed"):this.extcon.setImageData.call([],a,"flickr: api call failed")},data:b})},parsePhotos:function(b,d){var a=[],c=this,g;f.each(b.photos.photo,
function(e,h){g={raw:h};f.extend(g,{title:h.title,description:h.description._content,thumb:c.getFlickrURL(h,c.config.thumbSize),img:c.getFlickrURL(h,c.config.imageSize)});if(h.media=="video")g.content=c.getVideoContent(h,g.img);a.push(g)});this.extcon.setImageData(a,d)},getFlickrURL:function(b,d,a){if(a==undefined)a="";return"http://farm"+b[a+"farm"]+".static.flickr.com/"+b[a+"server"]+"/"+b[a+"id"]+"_"+b[a+"secret"]+"_"+d+".jpg"},getVideoContent:function(b,d){return'<video poster="'+d+'" type="video/mp4" src="'+
("http://www.flickr.com/photos/"+b.owner+"/"+b.id+"/play/site/"+b.secret+"/")+'" controls="controls" preload="none"></video>'},parseGalleries:function(b){var d=[],a=this,c;f.each(b.galleries.gallery,function(g,e){c={raw:e};f.extend(c,{title:e.title._content,description:e.description._content,thumb:a.getFlickrURL(e,a.config.thumbSize,"primary_photo_"),adata:{id:e.id,origin:"flickr"}});d.push(c)});this.extcon.setAlbumData(d)},parseGalleryInfo:function(b){var d=[],a=b.gallery;b={raw:a};f.extend(b,{title:a.title._content,
description:a.description._content,thumb:this.getFlickrURL(a,this.config.thumbSize,"primary_photo_"),adata:{id:a.id,origin:"flickr"}});d.push(b);this.extcon.setAlbumData(d)},parsePhotosets:function(b){var d=[],a=this,c;f.each(b.photosets.photoset,function(g,e){c={raw:e};f.extend(c,{title:e.title._content,description:e.description._content,thumb:a.getFlickrURL(f.extend({},e,{id:e.primary}),a.config.thumbSize),adata:{farm:e.farm,id:e.id,origin:"flickr"}});d.push(c)});this.extcon.setAlbumData(d)},parseSetInfo:function(b){var d=
[],a=b.photoset;b={raw:a};f.extend(b,{title:a.title._content,description:a.description._content,thumb:this.getFlickrURL(f.extend({},a,{id:a.primary}),this.config.thumbSize),adata:{farm:a.farm,id:a.id,origin:"flickr"}});d.push(b);this.extcon.setAlbumData(d)},parsePhotoset:function(b,d,a){var c=[],g=this,e;f.each(b.photoset.photo,function(h,i){i.farm=d.farm;e={raw:i};f.extend(e,{title:i.title,description:i.description._content,thumb:g.getFlickrURL(i,g.config.thumbSize),img:g.getFlickrURL(i,g.config.imageSize)});
if(i.media=="video")e.content=g.getVideoContent(i,e.img);c.push(e)});this.extcon.setImageData(c,a)}}})(jQuery);

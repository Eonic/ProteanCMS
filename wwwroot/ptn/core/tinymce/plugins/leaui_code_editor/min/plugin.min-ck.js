var LEAUI_CODE_EDITOR_DATAS={brush:"",text:"",node:null};tinymce.PluginManager.add("leaui_code_editor",function(e,t){function n(){LEAUI_CODE_EDITOR_DATAS={brush:"",text:"",node:null},a=e.dom;var t="",n=e.selection.getNode(),o=e.selection.getContent();if("PRE"==n.nodeName)try{LEAUI_CODE_EDITOR_DATAS.brush=a.getAttrib(n,"class").split(":")[1],t=n.innerHTML,LEAUI_CODE_EDITOR_DATAS.node=n}catch(r){}else if(o){try{document.createElement("p"),p.innerHTML=p,t=p.innerText}catch(r){}t||(t=o)}LEAUI_CODE_EDITOR_DATAS.text=t}function o(e,t){var n=document.createElement("p");n.innerHTML=t;var o=n.childNodes[0];e.parentNode.replaceChild(o,e)}function r(e){var t=document.createElement("p");return t.innerHTML=e,t.innerText}function i(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}var a,c=e;c.addCommand("leaui_code_editor",function(){n(),c.windowManager.open({title:"Insert code",html:'<iframe id="leauiCodesyntaxIfr" src="'+t+"/dialog.htm?"+(new Date).getTime()+'" frameborder="0"></iframe>',width:600,height:320,buttons:[{text:"Insert Code",subtype:"primary",onclick:function(){var t=document.getElementById("leauiCodesyntaxIfr").contentWindow,n=t.document.getElementById("lang"),o=n.value,r=t.LEAUI_CODE_EDITOR.session.getValue(),i="";o&&(i="brush:"+o);var c='<pre class="'+i+'">'+r+"</pre>";LEAUI_CODE_EDITOR_DATAS.node?(a.setAttrib(LEAUI_CODE_EDITOR_DATAS.node,"class",i),LEAUI_CODE_EDITOR_DATAS.node.innerHTML=r):e.insertContent(c),this.parent().parent().close()}},{text:"Cancel",onclick:function(){this.parent().parent().close()}}]})}),c.addButton("leaui_code_editor",{title:"Insert Code",cmd:"leaui_code_editor",icon:"code",stateSelector:"pre"}),c.addCommand("toggleCode",function(){var e,t=c.selection.getNode(),n=c.selection.getContent(),a=c.selection.getBookmark();try{e=i(r(n))}catch(d){}e||(e=i(n)),e?"PRE"==t.nodeName?o(t,"<p>"+$(t).html()+"</p>"):c.insertContent("<pre>"+e+"</pre>"):"PRE"==t.nodeName?o(t,"<p>"+t.innerHTML.replace(/\n/g,"<br />")+"</p>"):o(t,"<pre>"+t.innerHTML+"</pre>"),c.selection.moveToBookmark(a)}),c.addShortcut("ctrl+shift+c","","toggleCode"),c.addShortcut("command+shift+c","","toggleCode")});
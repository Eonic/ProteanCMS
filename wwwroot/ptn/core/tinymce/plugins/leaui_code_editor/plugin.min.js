var LEAUI_CODE_EDITOR_DATAS={brush:"",text:"",node:null};tinymce.PluginManager.add("leaui_code_editor",function(e,t){function n(){LEAUI_CODE_EDITOR_DATAS={brush:"",text:"",node:null},d=e.dom;var t="",n=e.selection.getNode(),o=e.selection.getContent();if("PRE"==n.nodeName)try{LEAUI_CODE_EDITOR_DATAS.brush=d.getAttrib(n,"class").split(":")[1],t=n.innerHTML,LEAUI_CODE_EDITOR_DATAS.node=n}catch(r){}else if(o){try{{document.createElement("p")}p.innerHTML=p,t=p.innerText}catch(r){}t||(t=o)}LEAUI_CODE_EDITOR_DATAS.text=t}function o(e){var t="";return 0==e.length?"":(t=e.replace(/&/g,"&gt;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"))}function r(e,t){var n=document.createElement("p");n.innerHTML=t;var o=n.childNodes[0];e.parentNode.replaceChild(o,e)}function c(e){var t=document.createElement("p");return t.innerHTML=e,t.innerText}function a(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}var d,i=e;i.addCommand("leaui_code_editor",function(){n(),i.windowManager.open({title:"Insert code",html:'<iframe id="leauiCodesyntaxIfr" src="'+t+"/dialog.htm?"+(new Date).getTime()+'" frameborder="0"></iframe>',width:600,height:320,buttons:[{text:"Insert Code",subtype:"primary",onclick:function(){var t=document.getElementById("leauiCodesyntaxIfr").contentWindow,n=t.document.getElementById("lang"),r=n.value,c=t.LEAUI_CODE_EDITOR.session.getValue();console.log(c),c=o(c),console.log(c);var a="";r&&(a="brush:"+r);var i='<pre class="'+a+'">'+c+"</pre>";LEAUI_CODE_EDITOR_DATAS.node?(d.setAttrib(LEAUI_CODE_EDITOR_DATAS.node,"class",a),LEAUI_CODE_EDITOR_DATAS.node.innerHTML=c):e.insertContent(i),this.parent().parent().close()}},{text:"Cancel",onclick:function(){this.parent().parent().close()}}]})}),i.addButton("leaui_code_editor",{title:"Insert Code",cmd:"leaui_code_editor",icon:"code",stateSelector:"pre"}),e.addMenuItem("leaui_code_editor",{icon:"code",text:"Insert Code",cmd:"leaui_code_editor",context:"insert",stateSelector:"pre",prependToContext:!0}),i.addCommand("toggleCode",function(){var e,t=i.selection.getNode(),n=i.selection.getContent(),o=i.selection.getBookmark();try{e=a(c(n))}catch(d){}e||(e=a(n)),e?"PRE"==t.nodeName?r(t,"<p>"+$(t).html()+"</p>"):i.insertContent("<pre>"+e+"</pre>"):"PRE"==t.nodeName?r(t,"<p>"+t.innerHTML.replace(/\n/g,"<br />")+"</p>"):r(t,"<pre>"+t.innerHTML+"</pre>"),i.selection.moveToBookmark(o)}),i.addShortcut("ctrl+shift+c","","toggleCode"),i.addShortcut("command+shift+c","","toggleCode")});